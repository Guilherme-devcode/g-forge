<div class="ai-chat-container"
     [style.width.px]="width"
     [style.height.px]="height"
     [attr.data-theme]="config.theme">

  <!-- Header -->
  <div class="chat-header">
    <div class="ai-info">
      <div class="ai-avatar">
        <img *ngIf="config.aiAvatar" [src]="config.aiAvatar" [alt]="config.aiName">
        <div *ngIf="!config.aiAvatar" class="default-avatar">
          <svg viewBox="0 0 24 24">
            <path d="M12 2C13.1 2 14 2.9 14 4C14 5.1 13.1 6 12 6C10.9 6 10 5.1 10 4C10 2.9 10.9 2 12 2ZM21 9V7L15 1H5C3.89 1 3 1.89 3 3V21C3 22.11 3.89 23 5 23H19C20.11 23 21 22.11 21 21V9M19 21H5V3H13V9H19Z"/>
          </svg>
        </div>
      </div>
      <div class="ai-details">
        <h3 class="ai-name">{{ config.aiName }}</h3>
        <span class="ai-status" [class.typing]="isTyping">
          {{ isTyping ? 'Digitando...' : 'Online' }}
        </span>
      </div>
    </div>
    
    <div class="chat-actions">
      <button class="action-btn" (click)="clearChat()" title="Limpar conversa">
        <svg viewBox="0 0 24 24">
          <path d="M19,4H15.5L14.5,3H9.5L8.5,4H5V6H19M6,19A2,2 0 0,0 8,21H16A2,2 0 0,0 18,19V7H6V19Z"/>
        </svg>
      </button>
    </div>
  </div>

  <!-- Messages -->
  <div #messagesContainer class="messages-container">
    <div class="messages-list">
      <div *ngFor="let message of messages; trackBy: trackByMessageId" 
           class="message-wrapper"
           [class.user-message]="message.sender === 'user'"
           [class.ai-message]="message.sender === 'ai'"
           [class.typing-message]="message.typing">

        <div class="message-bubble">
          <!-- Typing indicator -->
          <div *ngIf="message.typing" class="typing-indicator">
            <div class="typing-dots">
              <span></span>
              <span></span>
              <span></span>
            </div>
          </div>

          <!-- Message content -->
          <div *ngIf="!message.typing" class="message-content">
            <p [innerHTML]="formatMessageContent(message.content)"></p>
          </div>

          <!-- Timestamp -->
          <div *ngIf="config.showTimestamps && !message.typing" class="message-timestamp">
            {{ formatTimestamp(message.timestamp) }}
          </div>
        </div>

        <!-- Suggestions -->
        <div *ngIf="message.suggestions && message.suggestions.length > 0 && !message.typing" 
             class="message-suggestions">
          <button *ngFor="let suggestion of message.suggestions"
                  class="suggestion-chip"
                  (click)="onSuggestionClick(suggestion)">
            {{ suggestion }}
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Input -->
  <div class="chat-input-container">
    <div class="input-wrapper">
      <input #messageInput
             type="text"
             [(ngModel)]="currentMessage"
             [placeholder]="placeholder"
             [disabled]="disabled"
             (keypress)="onKeyPress($event)"
             class="message-input"
             autocomplete="off">
      
      <button class="send-button"
              [disabled]="!currentMessage.trim() || disabled"
              (click)="sendMessage()">
        <svg viewBox="0 0 24 24">
          <path d="M2,21L23,12L2,3V10L17,12L2,14V21Z"/>
        </svg>
      </button>
    </div>

    <!-- Quick suggestions -->
    <div *ngIf="config.showSuggestions && messages.length <= 1" class="quick-suggestions">
      <button *ngFor="let suggestion of suggestions"
              class="suggestion-chip"
              (click)="onSuggestionClick(suggestion)">
        {{ suggestion }}
      </button>
    </div>
  </div>
</div>